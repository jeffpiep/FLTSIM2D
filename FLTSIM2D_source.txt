'-----------------------------------------------------------
'
'					FLTSIM2D
'
'Longitudinal (2-D: Z & X) flight simulator 
'for Atari 800XL 2017 8-bit BASIC 10-Liner
'
'Jeff Piepmeier
'march 4, 2017
'http://jeffpiepmeier.blogspot.com/
'http://github.com/jeffpiep/
'
'Parsed with TurboBASIC XL Parser Tool 
'http://github.com/dmsc/tbxl-parser
$options +optimize, optimize=-convert_percent-const_replace
'Tested on Altirra
'-----------------------------------------------------------

'SET UP CONSTANTS AND INITIAL CONDITIONS
PI = 3.14159265DT = 0.1 : REM (S) TIME STEPVX = 60 : REM (M/S) INITIAL SPEEDVZ = 0 : REM (M/S)X = 0 : REM (M) INITIAL POSITIONZ = 1000 : REM (M)OMEGA = 0 : REM (RAD/S) INITIAL PITCH RATEPITCH = 0.087 : REM (RAD) INITIAL PITCHMASS = 1100 : REM (KG)G = 9.81 : REM (M/S^2) ACCEL OF GRAVITY
WEIGHT = MASS*G : REM (N)IYY = 1825 : REM (KG-M^2) MOMENT OF INERTIARHO = 1.225 : REM (KG/M^2) STP AIR DENSITYSW = 16.2 : REM (M^2) WIND AREASE = 3.3 : REM (M^2) TAILPLANE AREACM = -0.02 : REM WING MOMENT COEFFICIENTCHORD = 1.75 : REM (M) WIND CHORD LENGTHTHRUST = 1500 : REM (N) STATIC THRUSTARM = 6 : REM (M) TAILPLANE MOMENT ARMELANG = -0.5 : REM (DEG) ELEVATOR SETTING
CLS 
DO

?PITCH,Z

'ATMOSPHERE 
RHOZ = (1-Z*8.0E-05)*RHO : REM LINEAR APPROX AIR DENSITYQ = (VX^2+VZ^2)*RHOZ*0.5 : REM DYNAMIC PRESSURE
'PLANE
WIND = ATN(VZ/VX) : REM WIND COORDINATE SYSTEM ROTATION ANGLEAOA = PITCH-WIND : REM ANGLE OF ATTACKCL = SIN(2*AOA*(EXP(-ABS(AOA)/PI/8)+1))*1.35+0.25 : REM LIFT COEFFICIENT CD = SIN(AOA)^2+0.0223+9.2E-03+0.01 : REM DRAG COEFFICIENTLIFT = Q*CL*SW : REM LIFT FORCELX = -LIFT*SIN(WIND) : REM LIFT FORCE IN INERTIAL FRAMELZ = COS(WIND)*LIFTDRAG = Q*CD*SW : REM DRAG FORCEDX = -DRAG*COS(WIND) : REM DRAGE FORCE IN INERTIAL FRAMEDZ = -DRAG*SIN(WIND)
MW = Q*CM*SW*CHORD : REM MOMENT DUE TO WIND
'TAILPLANE
VE = OMEGA*ARM : REM TAILPLANE VELOCITY DUE TO PITCH RATEDVXE = -VE*SIN(PITCH) : REM RELATIVE VELOCITY IN INERTIAL FRAMEDVZE = COS(PITCH)*VEVXE = VX+DVXE : REM TAILPLANE TOTAL VELOCITY IN INERTIAL FRAMEVZE = VZ+DVZEWINDE = ATN(VZE/VXE) : REM TAILPLANE WIND COORDINATE FRAME ROTATIONAOAE = PITCH-WINDE : REM TAILPLANE ANGLE OF ATTACKCLE = SIN(2*AOAE)-ELANG/200 : REM TAILPLANE LIFT COEFFICIENTCDE = SIN(AOAE)^2*1.8 : REM TAILPLANE DRAG COEFFICIENTELIFT = Q*CLE*SE : REM TAILPLANE LIFT FORCEELX = -ELIFT*SIN(WINDE) : REM TAILPLANE LIFT FORCE IN INERTIAL FRAMEELZ = COS(WINDE)*ELIFTEDRAG = Q*CDE*SE : REM TAILPLANE DRAG FORCEEDX = -EDRAG*COS(WINDE) : REM TAILPLANE DRAG FORCE IN INERTIAL FRAMEEDZ = -EDRAG*SIN(WINDE)MEL = ELIFT*ARM*COS(AOAE) : REM TAILPLANE MOMENT DUE TO LIFTMED = EDRAG*ARM*SIN(AOAE) : REM TAILPLANE MOMENT DUE TO DRAG
'THRUST AND FUEL
TX = COS(PITCH)*THRUST : REM THRUST IN INERTIAL FRAMETZ = SIN(PITCH)*THRUST

'NEWTON'S THIRD LAW
FX = TX+LX+DX+ELX+EDX : REM SUM FORCESFZ = TZ+LZ+DZ+ELZ+EDZ-WEIGHTMM = MW+MEL+MED : REM SUM MOMENTS

'DUMP "P:"
'TIME STEP EQUATIONS OF MOTION: NEWTON'S FIRST & SECOND LAWS
VX = FX/MASS*DT+VX VZ = FZ/MASS*DT+VZOMEGA = MM/IYY*DT+OMEGA
X = VX*DT+XZ = VZ*DT+ZPITCH = PITCH-OMEGA*DT
LOOP 
